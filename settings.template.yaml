##################
### Admin user ###
##################

# The admin user is set up on all bootstrapped machines
admin:
  # If you are reusing your home directory on your TrueNAS, make sure the UID matches
  uid: 3000
  username: admin
  shell: /bin/bash
  # Generate with mkpasswd (from the `whois` package) and make sure to single quote
  # This one was generated with:
  # `tr -dc A-Za-z0-9~_- </dev/urandom | head -c 32 | mkpasswd --stdin`
  pwhash: '$y$j9T$zlDgloQTrQBmfTJj54fSZ1$V8YJxEyBZcPWZx1u8a51c4oC2yyH69WAYdHH92XCA37'
  # Each item is a line in the .ssh/authorized_keys file
  authorized_keys:
  - ssh-rsa ...
  - ssh-rsa ...
########################
### Machine settings ###
########################
machines:
  # Fixed name
  truenas:
    # Used to ensure scripts are run on the correct machine
    uuid: '755fd095cad346249ea190511773fc49'
  # Fixed name
  workstation:
    # Used to avoid confirmation prompts
    uuid: 'b435c0fc89f261bfc95c4d63664ee2e0'
  # Fixed name
  k8sMaster:
    hostname: k8s-nas.local
    layers: [base, node, k8s-master, truenas-vm, id, cleanup]
    nic:
      lan0:
        name: ens3
      host:
        name: ens4
        addrs: [10.186.223.3/24, 'fd25:9998:d0e7:e351:1a01:be9:4d9a:157f/48']
    arch: amd64
    uuid: '13d1132678d0c9013118fa11664ee2e4'
    vm: Kubernetes
    disk: /dev/zvol/cluster/Kubernetes
    fixedIPv4: '10.186.223.168'
    fixedIPv6: 'fd73:9867:6b4d:0:2a0:98ff:fe06:4044'
  # Customizable names
  k8sHyperV:
    hostname: k8s-hyperv.local
    layers: [base, node, k8s-node, pxe, hyperv, id, cleanup]
    nic:
      lan0:
        name: eth0
    arch: amd64
    uuid: '604d788acd2f4140d7b0cabd664ee2e9'
##################
### NFS Shares ###
##################
nfsShares:
  # Location of the home-cluster git repository
  homeCluster:
    addr: '[fd25:9998:d0e7:e351:1a01:be9:4d9a:157d]'
    path: /mnt/cluster/home-cluster
  # Location of UEFI and PXE boot images and intermediates.
  # Make sure to `mkdir dockerfiles initrd kernels raw snapshot squashfs`
  # in the mount you are not specifying the home-cluster/images subdir
  images:
    addr: '[fd25:9998:d0e7:e351:1a01:be9:4d9a:157d]'
    path: /mnt/cluster/images
  # NFS CSI driver mounts
  workloads:
    addr: '[fd25:9998:d0e7:e351:1a01:be9:4d9a:157d]'
    path: /mnt/cluster/workloads
  # Will be mounted to the admin user home directory, leave empty to not mount anything
  adminHome:
    addr: '[fd25:9998:d0e7:e351:1a01:be9:4d9a:157d]'
    path: /mnt/cluster/home/admin
#########################
### Cluster settings ###
#########################
cluster:
  # Top-level domain name of your cluster
  domain: example.org
  # Name of the acme provider to use
  acmeProvider:
    group: certmanager.step.sm
    kind: StepClusterIssuer
    issuer: step-issuer
  # IP to use for overriding external A record queries
  wanIPv4: '1.2.3.4'
  # Name of the PKI root & intermediate
  pkiName: 'Elysium'
  # CIDRs for the Kubernetes cluster
  # The IPv6 subnet can be a prefix delegated one from your ISP
  cidrs:
    podIPv4: '10.32.0.0/16'
    podIPv6: 'fd73:9867:6b4d:cafe:0000:32::/96'
    svcIPv4: '10.33.0.0/16'
    svcIPv6: 'fd73:9867:6b4d:cafe:0000:33::/112'
    lbIPv4: '10.34.0.0/16'
    lbIPv6: 'fd73:9867:6b4d:cafe:0000:34::/112'
  cilium:
    k8sServiceHost: 'fd73:9867:6b4d:0:2a0:98ff:fe06:4044'
  # Used for BGP
  router:
    fixedIPv4: '192.168.1.1'
    fixedIPv6: 'fd73:9867:6b4d:0:feec:daff:fe04:a9ec'
  # CoreDNS, the central DNS server for the entire cluster
  coredns:
    svc:
      # Fixed IP from the service subnet above for port forwarding
      fixedIPv4: '10.33.0.10'
      fixedIPv6: 'fd73:9867:6b4d:cafe:0000:34::1'
    lb:
      # Fixed IP from the load balancer subnet above for port forwarding
      fixedIPv4: '10.34.0.2'
      fixedIPv6: 'fd73:9867:6b4d:cafe:0:34::2'
  etcd:
    # Fixed etcd IP address for coredns, note that this is from the svc pool and not the lb pool
    fixedIPv4: '10.33.0.2'
    fixedIPv6: 'fd73:9867:6b4d:cafe:0:33:0:2'
  # Traefik reverse-proxy
  traefik:
    fixedIPv4: '10.34.0.2'
    fixedIPv6: 'fd73:9867:6b4d:cafe:0000:34::2'
  # Smallstep PKI
  smallstep:
    fixedIPv4: '10.34.0.3'
    fixedIPv6: 'fd73:9867:6b4d:cafe:0000:34::3'
  # Smallstep Kubernetes CA for renewing kubernetes client certs
  kubeAPIServerClientCA:
    fixedIPv4: '10.34.0.5'
    fixedIPv6: 'fd73:9867:6b4d:cafe:0:34::5'
  # HTTP server that distributes kernels for PXE booted machines
  kernelServer:
    fixedIPv4: '10.34.0.6'
    fixedIPv6: 'fd73:9867:6b4d:cafe:0:34::6'
  # NBD server that hosts root images for PXE booted machines
  nbdServer:
    fixedIPv4: '10.34.0.7'
    fixedIPv6: 'fd73:9867:6b4d:cafe:0:34::6'
unifi:
  usg_ssh_address: 'admin@192.168.1.1'
  cloudkey_ssh_address: 'ubnt@192.168.1.3'
  unifi_site: default
