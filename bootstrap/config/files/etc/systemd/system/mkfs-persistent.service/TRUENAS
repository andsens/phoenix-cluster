[Unit]
Description=Create a filesystem on the persistent volume
Before=var-lib-persistent.mount

[Install]
WantedBy=persistent-volume.target

[Service]
Type=oneshot
ExecCondition=blkid {%TRUENAS_PERSISTENT_VOLUME_DEV_PATH%}
ExecStart=mkfs.ext4 {%TRUENAS_PERSISTENT_VOLUME_DEV_PATH%}
