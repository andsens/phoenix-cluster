#!/usr/bin/env bash
set -Eeo pipefail; shopt -s inherit_errexit

main() {
  [[ $# -eq 0 ]] || usage
  local tarfile
  for tarfile in /var/lib/phoenix-cluster/container-images/*.tar; do
    printf "Importing %s\n" "$(basename "$tarfile" .tar)" >&2
    ctr -n k8s.io image import --snapshotter stargz "$tarfile"
    rm "$tarfile"
  done
}

usage() {
  printf "Usage: import-container-images\n" >&2
  return 1
}

main "$@"
