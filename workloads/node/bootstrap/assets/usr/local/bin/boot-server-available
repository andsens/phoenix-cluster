#!/usr/bin/env bash
set -Eeo pipefail; shopt -s inherit_errexit

main() {
  [[ $# -eq 0 ]] || usage
  local boot_server_ip
  boot_server_ip=$(get-node-state boot-server) || return 1
  if [[ $(curl  --cacert /usr/local/share/ca-certificates/home-cluster-root.crt \
    --connect-to "boot-server.node.svc.cluster.local:8020:$boot_server_ip:8020" \
    -sw '%{http_code}' -o/dev/null "https://boot-server.node.svc.cluster.local:8020/health") = 200 ]]; then
    return 0
  else
    return 1
  fi
}

usage() {
  printf "Usage: boot-server-available\n" >&2
  return 1
}

main "$@"
