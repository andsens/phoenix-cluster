#!/usr/bin/env bash
set -Eeo pipefail; shopt -s inherit_errexit
# Make sure the node configuration has been downloaded or copied from the boot partition before unmounting
[[ $1 != prereqs ]] || { echo "node-config"; exit 0; }

PKGROOT=$(realpath "$(dirname "$(realpath "${BASH_SOURCE[0]}")")/..")
# shellcheck source=../common.sh
source "$PKGROOT/common.sh"

main() {
  boot=/run/initramfs/boot
  if [[ -e $boot ]]; then
    info "Boot partition mount detected, unmounting"
    umount "$boot"
    rm -rf "$boot"
  fi
}

main "$@"
