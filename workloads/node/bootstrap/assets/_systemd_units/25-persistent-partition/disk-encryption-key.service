[Unit]
Description=Extract the disk encryption key from the node-config
DefaultDependencies=no
Requires=node-config.service
After=node-config.service
Before=systemd-cryptsetup@data.service

[Install]
RequiredBy=data-partition.target systemd-cryptsetup@data.service

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=bash -ec "umask 0077; get-node-config disk.encryption-key | base64 -d >/run/initramfs/disk-encryption-key"
openssl rand -hex 64
