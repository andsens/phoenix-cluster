apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: step-ca
labels:
- pairs:
    app.kubernetes.io/name: step-certificates
  includeSelectors: true
  includeTemplates: true
resources:
- bootstrap.yaml
- step-ca.yaml
- cluster-vars.yaml
- namespace.yaml
- Kptfile
- resourcegroup.yaml
configMapGenerator:
- files:
  - config/bootstrap.sh
  name: step-ca-bootstrap
- files:
  - config/ca.json
  name: step-ca-config
- files: []
  name: step-ca-templates
generatorOptions:
  disableNameSuffixHash: true
replacements:
- source:
    kind: ConfigMap
    name: cluster-vars
    fieldPath: data.CLUSTER_NAME
  targets:
  - select:
      group: batch
      kind: Job
      name: step-ca-bootstrap
    fieldPaths:
    - spec.template.spec.containers.[name=step-ca-bootstrap].env.[name=CLUSTER_NAME].value
